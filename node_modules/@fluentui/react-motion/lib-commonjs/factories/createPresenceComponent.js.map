{"version":3,"sources":["createPresenceComponent.js"],"sourcesContent":["import { useEventCallback, useFirstMount, useIsomorphicLayoutEffect, useMergedRefs } from '@fluentui/react-utilities';\nimport * as React from 'react';\nimport { PresenceGroupChildContext } from '../contexts/PresenceGroupChildContext';\nimport { useIsReducedMotion } from '../hooks/useIsReducedMotion';\nimport { useMotionImperativeRef } from '../hooks/useMotionImperativeRef';\nimport { useMountedState } from '../hooks/useMountedState';\nimport { animateAtoms } from '../utils/animateAtoms';\nimport { getChildElement } from '../utils/getChildElement';\nfunction shouldSkipAnimation(appear, isFirstMount, visible) {\n    return !appear && isFirstMount && !!visible;\n}\nexport function createPresenceComponent(value) {\n    const Presence = (props)=>{\n        const itemContext = React.useContext(PresenceGroupChildContext);\n        const merged = {\n            ...itemContext,\n            ...props\n        };\n        const { appear, children, imperativeRef, onExit, onMotionFinish, onMotionStart, onMotionCancel, visible, unmountOnExit, ..._rest } = merged;\n        const params = _rest;\n        const [mounted, setMounted] = useMountedState(visible, unmountOnExit);\n        const child = getChildElement(children);\n        const handleRef = useMotionImperativeRef(imperativeRef);\n        const elementRef = React.useRef();\n        const ref = useMergedRefs(elementRef, child.ref);\n        const optionsRef = React.useRef({\n            appear,\n            params\n        });\n        const isFirstMount = useFirstMount();\n        const isReducedMotion = useIsReducedMotion();\n        const handleMotionStart = useEventCallback((direction)=>{\n            onMotionStart === null || onMotionStart === void 0 ? void 0 : onMotionStart(null, {\n                direction\n            });\n        });\n        const handleMotionFinish = useEventCallback((direction)=>{\n            onMotionFinish === null || onMotionFinish === void 0 ? void 0 : onMotionFinish(null, {\n                direction\n            });\n            if (direction === 'exit' && unmountOnExit) {\n                setMounted(false);\n                onExit === null || onExit === void 0 ? void 0 : onExit();\n            }\n        });\n        const handleMotionCancel = useEventCallback((direction)=>{\n            onMotionCancel === null || onMotionCancel === void 0 ? void 0 : onMotionCancel(null, {\n                direction\n            });\n        });\n        useIsomorphicLayoutEffect(()=>{\n            // Heads up!\n            // We store the params in a ref to avoid re-rendering the component when the params change.\n            optionsRef.current = {\n                appear,\n                params\n            };\n        });\n        useIsomorphicLayoutEffect(()=>{\n            const element = elementRef.current;\n            if (!element || shouldSkipAnimation(optionsRef.current.appear, isFirstMount, visible)) {\n                return;\n            }\n            const presenceMotion = typeof value === 'function' ? value({\n                element,\n                ...optionsRef.current.params\n            }) : value;\n            const atoms = visible ? presenceMotion.enter : presenceMotion.exit;\n            const direction = visible ? 'enter' : 'exit';\n            const forceFinishMotion = !visible && isFirstMount;\n            if (!forceFinishMotion) {\n                handleMotionStart(direction);\n            }\n            const handle = animateAtoms(element, atoms, {\n                isReducedMotion: isReducedMotion()\n            });\n            if (forceFinishMotion) {\n                // Heads up!\n                // .finish() is used there to skip animation on first mount, but apply animation styles immediately\n                handle.finish();\n                return;\n            }\n            handleRef.current = handle;\n            handle.setMotionEndCallbacks(()=>handleMotionFinish(direction), ()=>handleMotionCancel(direction));\n            return ()=>{\n                handle.cancel();\n            };\n        }, // Excluding `isFirstMount` from deps to prevent re-triggering the animation on subsequent renders\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [\n            handleRef,\n            isReducedMotion,\n            handleMotionFinish,\n            handleMotionStart,\n            handleMotionCancel,\n            visible\n        ]);\n        if (mounted) {\n            return React.cloneElement(child, {\n                ref\n            });\n        }\n        return null;\n    };\n    return Presence;\n}\n"],"names":["createPresenceComponent","shouldSkipAnimation","appear","isFirstMount","visible","value","Presence","props","itemContext","React","useContext","PresenceGroupChildContext","merged","children","imperativeRef","onExit","onMotionFinish","onMotionStart","onMotionCancel","unmountOnExit","_rest","params","mounted","setMounted","useMountedState","child","getChildElement","handleRef","useMotionImperativeRef","elementRef","useRef","ref","useMergedRefs","optionsRef","useFirstMount","isReducedMotion","useIsReducedMotion","handleMotionStart","useEventCallback","direction","handleMotionFinish","handleMotionCancel","useIsomorphicLayoutEffect","current","element","presenceMotion","atoms","enter","exit","forceFinishMotion","handle","animateAtoms","finish","setMotionEndCallbacks","cancel","cloneElement"],"mappings":";;;;+BAWgBA;;;eAAAA;;;;gCAX0E;iEACnE;2CACmB;oCACP;wCACI;iCACP;8BACH;iCACG;AAChC,SAASC,oBAAoBC,MAAM,EAAEC,YAAY,EAAEC,OAAO;IACtD,OAAO,CAACF,UAAUC,gBAAgB,CAAC,CAACC;AACxC;AACO,SAASJ,wBAAwBK,KAAK;IACzC,MAAMC,WAAW,CAACC;QACd,MAAMC,cAAcC,OAAMC,UAAU,CAACC,oDAAyB;QAC9D,MAAMC,SAAS;YACX,GAAGJ,WAAW;YACd,GAAGD,KAAK;QACZ;QACA,MAAM,EAAEL,MAAM,EAAEW,QAAQ,EAAEC,aAAa,EAAEC,MAAM,EAAEC,cAAc,EAAEC,aAAa,EAAEC,cAAc,EAAEd,OAAO,EAAEe,aAAa,EAAE,GAAGC,OAAO,GAAGR;QACrI,MAAMS,SAASD;QACf,MAAM,CAACE,SAASC,WAAW,GAAGC,IAAAA,gCAAe,EAACpB,SAASe;QACvD,MAAMM,QAAQC,IAAAA,gCAAe,EAACb;QAC9B,MAAMc,YAAYC,IAAAA,8CAAsB,EAACd;QACzC,MAAMe,aAAapB,OAAMqB,MAAM;QAC/B,MAAMC,MAAMC,IAAAA,6BAAa,EAACH,YAAYJ,MAAMM,GAAG;QAC/C,MAAME,aAAaxB,OAAMqB,MAAM,CAAC;YAC5B5B;YACAmB;QACJ;QACA,MAAMlB,eAAe+B,IAAAA,6BAAa;QAClC,MAAMC,kBAAkBC,IAAAA,sCAAkB;QAC1C,MAAMC,oBAAoBC,IAAAA,gCAAgB,EAAC,CAACC;YACxCtB,kBAAkB,QAAQA,kBAAkB,KAAK,IAAI,KAAK,IAAIA,cAAc,MAAM;gBAC9EsB;YACJ;QACJ;QACA,MAAMC,qBAAqBF,IAAAA,gCAAgB,EAAC,CAACC;YACzCvB,mBAAmB,QAAQA,mBAAmB,KAAK,IAAI,KAAK,IAAIA,eAAe,MAAM;gBACjFuB;YACJ;YACA,IAAIA,cAAc,UAAUpB,eAAe;gBACvCI,WAAW;gBACXR,WAAW,QAAQA,WAAW,KAAK,IAAI,KAAK,IAAIA;YACpD;QACJ;QACA,MAAM0B,qBAAqBH,IAAAA,gCAAgB,EAAC,CAACC;YACzCrB,mBAAmB,QAAQA,mBAAmB,KAAK,IAAI,KAAK,IAAIA,eAAe,MAAM;gBACjFqB;YACJ;QACJ;QACAG,IAAAA,yCAAyB,EAAC;YACtB,YAAY;YACZ,2FAA2F;YAC3FT,WAAWU,OAAO,GAAG;gBACjBzC;gBACAmB;YACJ;QACJ;QACAqB,IAAAA,yCAAyB,EAAC;YACtB,MAAME,UAAUf,WAAWc,OAAO;YAClC,IAAI,CAACC,WAAW3C,oBAAoBgC,WAAWU,OAAO,CAACzC,MAAM,EAAEC,cAAcC,UAAU;gBACnF;YACJ;YACA,MAAMyC,iBAAiB,OAAOxC,UAAU,aAAaA,MAAM;gBACvDuC;gBACA,GAAGX,WAAWU,OAAO,CAACtB,MAAM;YAChC,KAAKhB;YACL,MAAMyC,QAAQ1C,UAAUyC,eAAeE,KAAK,GAAGF,eAAeG,IAAI;YAClE,MAAMT,YAAYnC,UAAU,UAAU;YACtC,MAAM6C,oBAAoB,CAAC7C,WAAWD;YACtC,IAAI,CAAC8C,mBAAmB;gBACpBZ,kBAAkBE;YACtB;YACA,MAAMW,SAASC,IAAAA,0BAAY,EAACP,SAASE,OAAO;gBACxCX,iBAAiBA;YACrB;YACA,IAAIc,mBAAmB;gBACnB,YAAY;gBACZ,mGAAmG;gBACnGC,OAAOE,MAAM;gBACb;YACJ;YACAzB,UAAUgB,OAAO,GAAGO;YACpBA,OAAOG,qBAAqB,CAAC,IAAIb,mBAAmBD,YAAY,IAAIE,mBAAmBF;YACvF,OAAO;gBACHW,OAAOI,MAAM;YACjB;QACJ,GACA,uDAAuD;QACvD;YACI3B;YACAQ;YACAK;YACAH;YACAI;YACArC;SACH;QACD,IAAIkB,SAAS;YACT,qBAAOb,OAAM8C,YAAY,CAAC9B,OAAO;gBAC7BM;YACJ;QACJ;QACA,OAAO;IACX;IACA,OAAOzB;AACX"}