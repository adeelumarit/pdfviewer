{"version":3,"sources":["animateAtoms.ts"],"sourcesContent":["import type { AnimationHandle, AtomMotion } from '../types';\n\nexport function animateAtoms(\n  element: HTMLElement,\n  value: AtomMotion | AtomMotion[],\n  options: {\n    isReducedMotion: boolean;\n  },\n): AnimationHandle {\n  // Heads up!\n  // Jest uses jsdom as the default environment, which doesn't support the Web Animations API. The same is true for\n  // older browsers that are out of browser support matrix. In these cases, the animation will be a no-op.\n  const SUPPORTS_WEB_ANIMATIONS = typeof element.animate === 'function';\n\n  const atoms = Array.isArray(value) ? value : [value];\n  const { isReducedMotion } = options;\n\n  const animations = SUPPORTS_WEB_ANIMATIONS\n    ? atoms.map(motion => {\n        const { keyframes, ...params } = motion;\n        const animation = element.animate(keyframes, {\n          fill: 'forwards',\n\n          ...params,\n          ...(isReducedMotion && { duration: 1 }),\n        });\n\n        animation.persist();\n\n        return animation;\n      })\n    : [];\n\n  return {\n    set playbackRate(rate: number) {\n      animations.forEach(animation => {\n        animation.playbackRate = rate;\n      });\n    },\n    setMotionEndCallbacks(onfinish: () => void, oncancel: () => void) {\n      // Heads up!\n      // Jest uses jsdom as the default environment, which doesn't support the Web Animations API. This no-op is\n      // necessary to avoid errors in tests.\n      //\n      // See https://github.com/microsoft/fluentui/issues/31593\n      // See https://github.com/jsdom/jsdom/issues/3429\n      if (process.env.NODE_ENV === 'test') {\n        if (animations.length === 0) {\n          onfinish();\n          return;\n        }\n      }\n\n      Promise.all(animations.map(animation => animation.finished))\n        .then(() => {\n          onfinish();\n        })\n        .catch((err: unknown) => {\n          const DOMException = element.ownerDocument.defaultView?.DOMException;\n\n          // Ignores \"DOMException: The user aborted a request\" that appears if animations are cancelled\n          if (DOMException && err instanceof DOMException && err.name === 'AbortError') {\n            oncancel();\n            return;\n          }\n\n          throw err;\n        });\n    },\n\n    cancel: () => {\n      animations.forEach(animation => {\n        animation.cancel();\n      });\n    },\n    pause: () => {\n      animations.forEach(animation => {\n        animation.pause();\n      });\n    },\n    play: () => {\n      animations.forEach(animation => {\n        animation.play();\n      });\n    },\n    finish: () => {\n      animations.forEach(animation => {\n        animation.finish();\n      });\n    },\n  };\n}\n"],"names":["animateAtoms","element","value","options","SUPPORTS_WEB_ANIMATIONS","animate","atoms","Array","isArray","isReducedMotion","animations","map","motion","keyframes","params","animation","fill","duration","persist","playbackRate","rate","forEach","setMotionEndCallbacks","onfinish","oncancel","process","env","NODE_ENV","length","Promise","all","finished","then","catch","err","DOMException","ownerDocument","defaultView","name","cancel","pause","play","finish"],"mappings":"AAEA,OAAO,SAASA,aACdC,OAAoB,EACpBC,KAAgC,EAChCC,OAEC;IAED,YAAY;IACZ,iHAAiH;IACjH,wGAAwG;IACxG,MAAMC,0BAA0B,OAAOH,QAAQI,OAAO,KAAK;IAE3D,MAAMC,QAAQC,MAAMC,OAAO,CAACN,SAASA,QAAQ;QAACA;KAAM;IACpD,MAAM,EAAEO,eAAe,EAAE,GAAGN;IAE5B,MAAMO,aAAaN,0BACfE,MAAMK,GAAG,CAACC,CAAAA;QACR,MAAM,EAAEC,SAAS,EAAE,GAAGC,QAAQ,GAAGF;QACjC,MAAMG,YAAYd,QAAQI,OAAO,CAACQ,WAAW;YAC3CG,MAAM;YAEN,GAAGF,MAAM;YACT,GAAIL,mBAAmB;gBAAEQ,UAAU;YAAE,CAAC;QACxC;QAEAF,UAAUG,OAAO;QAEjB,OAAOH;IACT,KACA,EAAE;IAEN,OAAO;QACL,IAAII,cAAaC,KAAc;YAC7BV,WAAWW,OAAO,CAACN,CAAAA;gBACjBA,UAAUI,YAAY,GAAGC;YAC3B;QACF;QACAE,uBAAsBC,QAAoB,EAAEC,QAAoB;YAC9D,YAAY;YACZ,0GAA0G;YAC1G,sCAAsC;YACtC,EAAE;YACF,yDAAyD;YACzD,iDAAiD;YACjD,IAAIC,QAAQC,GAAG,CAACC,QAAQ,KAAK,QAAQ;gBACnC,IAAIjB,WAAWkB,MAAM,KAAK,GAAG;oBAC3BL;oBACA;gBACF;YACF;YAEAM,QAAQC,GAAG,CAACpB,WAAWC,GAAG,CAACI,CAAAA,YAAaA,UAAUgB,QAAQ,GACvDC,IAAI,CAAC;gBACJT;YACF,GACCU,KAAK,CAAC,CAACC;oBACejC;gBAArB,MAAMkC,gBAAelC,qCAAAA,QAAQmC,aAAa,CAACC,WAAW,cAAjCpC,yDAAAA,mCAAmCkC,YAAY;gBAEpE,8FAA8F;gBAC9F,IAAIA,gBAAgBD,eAAeC,gBAAgBD,IAAII,IAAI,KAAK,cAAc;oBAC5Ed;oBACA;gBACF;gBAEA,MAAMU;YACR;QACJ;QAEAK,QAAQ;YACN7B,WAAWW,OAAO,CAACN,CAAAA;gBACjBA,UAAUwB,MAAM;YAClB;QACF;QACAC,OAAO;YACL9B,WAAWW,OAAO,CAACN,CAAAA;gBACjBA,UAAUyB,KAAK;YACjB;QACF;QACAC,MAAM;YACJ/B,WAAWW,OAAO,CAACN,CAAAA;gBACjBA,UAAU0B,IAAI;YAChB;QACF;QACAC,QAAQ;YACNhC,WAAWW,OAAO,CAACN,CAAAA;gBACjBA,UAAU2B,MAAM;YAClB;QACF;IACF;AACF"}