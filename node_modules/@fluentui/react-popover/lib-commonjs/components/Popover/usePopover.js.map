{"version":3,"sources":["usePopover.js"],"sourcesContent":["import * as React from 'react';\nimport { useControllableState, useEventCallback, useOnClickOutside, useOnScrollOutside, elementContains, useTimeout } from '@fluentui/react-utilities';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { usePositioning, resolvePositioningShorthand, mergeArrowOffset, usePositioningMouseTarget } from '@fluentui/react-positioning';\nimport { useFocusFinders } from '@fluentui/react-tabster';\nimport { arrowHeights } from '../PopoverSurface/index';\nimport { popoverSurfaceBorderRadius } from './constants';\n/**\n * Create the state required to render Popover.\n *\n * The returned state can be modified with hooks such as usePopoverStyles,\n * before being passed to renderPopover_unstable.\n *\n * @param props - props from this instance of Popover\n */ export const usePopover_unstable = (props)=>{\n    const [contextTarget, setContextTarget] = usePositioningMouseTarget();\n    const initialState = {\n        size: 'medium',\n        contextTarget,\n        setContextTarget,\n        ...props\n    };\n    const children = React.Children.toArray(props.children);\n    if (process.env.NODE_ENV !== 'production') {\n        if (children.length === 0) {\n            // eslint-disable-next-line no-console\n            console.warn('Popover must contain at least one child');\n        }\n        if (children.length > 2) {\n            // eslint-disable-next-line no-console\n            console.warn('Popover must contain at most two children');\n        }\n    }\n    let popoverTrigger = undefined;\n    let popoverSurface = undefined;\n    if (children.length === 2) {\n        popoverTrigger = children[0];\n        popoverSurface = children[1];\n    } else if (children.length === 1) {\n        popoverSurface = children[0];\n    }\n    const [open, setOpenState] = useOpenState(initialState);\n    const [setOpenTimeout, clearOpenTimeout] = useTimeout();\n    const setOpen = useEventCallback((e, shouldOpen)=>{\n        clearOpenTimeout();\n        if (!(e instanceof Event) && e.persist) {\n            // < React 17 still uses pooled synthetic events\n            e.persist();\n        }\n        if (e.type === 'mouseleave') {\n            var _props_mouseLeaveDelay;\n            // FIXME leaking Node timeout type\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            setOpenTimeout(()=>{\n                setOpenState(e, shouldOpen);\n            }, (_props_mouseLeaveDelay = props.mouseLeaveDelay) !== null && _props_mouseLeaveDelay !== void 0 ? _props_mouseLeaveDelay : 500);\n        } else {\n            setOpenState(e, shouldOpen);\n        }\n    });\n    const toggleOpen = React.useCallback((e)=>{\n        setOpen(e, !open);\n    }, [\n        setOpen,\n        open\n    ]);\n    const positioningRefs = usePopoverRefs(initialState);\n    const { targetDocument } = useFluent();\n    var _props_closeOnIframeFocus;\n    useOnClickOutside({\n        contains: elementContains,\n        element: targetDocument,\n        callback: (ev)=>setOpen(ev, false),\n        refs: [\n            positioningRefs.triggerRef,\n            positioningRefs.contentRef\n        ],\n        disabled: !open,\n        disabledFocusOnIframe: !((_props_closeOnIframeFocus = props.closeOnIframeFocus) !== null && _props_closeOnIframeFocus !== void 0 ? _props_closeOnIframeFocus : true)\n    });\n    // only close on scroll for context, or when closeOnScroll is specified\n    const closeOnScroll = initialState.openOnContext || initialState.closeOnScroll;\n    useOnScrollOutside({\n        contains: elementContains,\n        element: targetDocument,\n        callback: (ev)=>setOpen(ev, false),\n        refs: [\n            positioningRefs.triggerRef,\n            positioningRefs.contentRef\n        ],\n        disabled: !open || !closeOnScroll\n    });\n    const { findFirstFocusable } = useFocusFinders();\n    React.useEffect(()=>{\n        if (props.unstable_disableAutoFocus) {\n            return;\n        }\n        if (open && positioningRefs.contentRef.current) {\n            var _positioningRefs_contentRef_current_getAttribute;\n            const containerTabIndex = (_positioningRefs_contentRef_current_getAttribute = positioningRefs.contentRef.current.getAttribute('tabIndex')) !== null && _positioningRefs_contentRef_current_getAttribute !== void 0 ? _positioningRefs_contentRef_current_getAttribute : undefined;\n            const firstFocusable = isNaN(containerTabIndex) ? findFirstFocusable(positioningRefs.contentRef.current) : positioningRefs.contentRef.current;\n            firstFocusable === null || firstFocusable === void 0 ? void 0 : firstFocusable.focus();\n        }\n    }, [\n        findFirstFocusable,\n        open,\n        positioningRefs.contentRef,\n        props.unstable_disableAutoFocus\n    ]);\n    var _props_inertTrapFocus, _props_inline;\n    return {\n        ...initialState,\n        ...positioningRefs,\n        // eslint-disable-next-line deprecation/deprecation\n        inertTrapFocus: (_props_inertTrapFocus = props.inertTrapFocus) !== null && _props_inertTrapFocus !== void 0 ? _props_inertTrapFocus : props.legacyTrapFocus === undefined ? false : !props.legacyTrapFocus,\n        popoverTrigger,\n        popoverSurface,\n        open,\n        setOpen,\n        toggleOpen,\n        setContextTarget,\n        contextTarget,\n        inline: (_props_inline = props.inline) !== null && _props_inline !== void 0 ? _props_inline : false\n    };\n};\n/**\n * Creates and manages the Popover open state\n */ function useOpenState(state) {\n    const onOpenChange = useEventCallback((e, data)=>{\n        var _state_onOpenChange;\n        return (_state_onOpenChange = state.onOpenChange) === null || _state_onOpenChange === void 0 ? void 0 : _state_onOpenChange.call(state, e, data);\n    });\n    const [open, setOpenState] = useControllableState({\n        state: state.open,\n        defaultState: state.defaultOpen,\n        initialState: false\n    });\n    state.open = open !== undefined ? open : state.open;\n    const setContextTarget = state.setContextTarget;\n    const setOpen = React.useCallback((e, shouldOpen)=>{\n        if (shouldOpen && e.type === 'contextmenu') {\n            setContextTarget(e);\n        }\n        if (!shouldOpen) {\n            setContextTarget(undefined);\n        }\n        setOpenState(shouldOpen);\n        onOpenChange === null || onOpenChange === void 0 ? void 0 : onOpenChange(e, {\n            open: shouldOpen\n        });\n    }, [\n        setOpenState,\n        onOpenChange,\n        setContextTarget\n    ]);\n    return [\n        open,\n        setOpen\n    ];\n}\n/**\n * Creates and sets the necessary trigger, target and content refs used by Popover\n */ function usePopoverRefs(state) {\n    const positioningOptions = {\n        position: 'above',\n        align: 'center',\n        arrowPadding: 2 * popoverSurfaceBorderRadius,\n        target: state.openOnContext ? state.contextTarget : undefined,\n        ...resolvePositioningShorthand(state.positioning)\n    };\n    // no reason to render arrow when covering the target\n    if (positioningOptions.coverTarget) {\n        state.withArrow = false;\n    }\n    if (state.withArrow) {\n        positioningOptions.offset = mergeArrowOffset(positioningOptions.offset, arrowHeights[state.size]);\n    }\n    const { targetRef: triggerRef, containerRef: contentRef, arrowRef } = usePositioning(positioningOptions);\n    return {\n        triggerRef,\n        contentRef,\n        arrowRef\n    };\n}\n"],"names":["usePopover_unstable","props","contextTarget","setContextTarget","usePositioningMouseTarget","initialState","size","children","React","Children","toArray","process","env","NODE_ENV","length","console","warn","popoverTrigger","undefined","popoverSurface","open","setOpenState","useOpenState","setOpenTimeout","clearOpenTimeout","useTimeout","setOpen","useEventCallback","e","shouldOpen","Event","persist","type","_props_mouseLeaveDelay","mouseLeaveDelay","toggleOpen","useCallback","positioningRefs","usePopoverRefs","targetDocument","useFluent","_props_closeOnIframeFocus","useOnClickOutside","contains","elementContains","element","callback","ev","refs","triggerRef","contentRef","disabled","disabledFocusOnIframe","closeOnIframeFocus","closeOnScroll","openOnContext","useOnScrollOutside","findFirstFocusable","useFocusFinders","useEffect","unstable_disableAutoFocus","current","_positioningRefs_contentRef_current_getAttribute","containerTabIndex","getAttribute","firstFocusable","isNaN","focus","_props_inertTrapFocus","_props_inline","inertTrapFocus","legacyTrapFocus","inline","state","onOpenChange","data","_state_onOpenChange","call","useControllableState","defaultState","defaultOpen","positioningOptions","position","align","arrowPadding","popoverSurfaceBorderRadius","target","resolvePositioningShorthand","positioning","coverTarget","withArrow","offset","mergeArrowOffset","arrowHeights","targetRef","containerRef","arrowRef","usePositioning"],"mappings":"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"}