{"version":3,"sources":["useContextSelector.js"],"sourcesContent":["import { useEventCallback, useIsomorphicLayoutEffect } from '@fluentui/react-utilities';\nimport * as React from 'react';\n/**\n * @internal\n * This hook returns context selected value by selector.\n * It will only accept context created by `createContext`.\n * It will trigger re-render if only the selected value is referentially changed.\n */ export const useContextSelector = (context, selector)=>{\n    const contextValue = React.useContext(context);\n    const { value: { current: value }, version: { current: version }, listeners } = contextValue;\n    const selected = selector(value);\n    const [state, setState] = React.useState([\n        value,\n        selected\n    ]);\n    const dispatch = (payload)=>{\n        setState((prevState)=>{\n            if (!payload) {\n                // early bail out when is dispatched during render\n                return [\n                    value,\n                    selected\n                ];\n            }\n            if (payload[0] <= version) {\n                if (Object.is(prevState[1], selected)) {\n                    return prevState; // bail out\n                }\n                return [\n                    value,\n                    selected\n                ];\n            }\n            try {\n                if (Object.is(prevState[0], payload[1])) {\n                    return prevState; // do not update\n                }\n                const nextSelected = selector(payload[1]);\n                if (Object.is(prevState[1], nextSelected)) {\n                    return prevState; // do not update\n                }\n                return [\n                    payload[1],\n                    nextSelected\n                ];\n            } catch (e) {\n            // ignored (stale props or some other reason)\n            }\n            // explicitly spread to enforce typing\n            return [\n                prevState[0],\n                prevState[1]\n            ]; // schedule update\n        });\n    };\n    if (!Object.is(state[1], selected)) {\n        // schedule re-render\n        // this is safe because it's self contained\n        dispatch(undefined);\n    }\n    const stableDispatch = useEventCallback(dispatch);\n    useIsomorphicLayoutEffect(()=>{\n        listeners.push(stableDispatch);\n        return ()=>{\n            const index = listeners.indexOf(stableDispatch);\n            listeners.splice(index, 1);\n        };\n    }, [\n        stableDispatch,\n        listeners\n    ]);\n    return state[1];\n};\n"],"names":["useContextSelector","context","selector","contextValue","React","useContext","value","current","version","listeners","selected","state","setState","useState","dispatch","payload","prevState","Object","is","nextSelected","e","undefined","stableDispatch","useEventCallback","useIsomorphicLayoutEffect","push","index","indexOf","splice"],"mappings":";;;;+BAOiBA;;;eAAAA;;;;gCAP2C;iEACrC;AAMZ,MAAMA,qBAAqB,CAACC,SAASC;IAC5C,MAAMC,eAAeC,OAAMC,UAAU,CAACJ;IACtC,MAAM,EAAEK,OAAO,EAAEC,SAASD,KAAK,EAAE,EAAEE,SAAS,EAAED,SAASC,OAAO,EAAE,EAAEC,SAAS,EAAE,GAAGN;IAChF,MAAMO,WAAWR,SAASI;IAC1B,MAAM,CAACK,OAAOC,SAAS,GAAGR,OAAMS,QAAQ,CAAC;QACrCP;QACAI;KACH;IACD,MAAMI,WAAW,CAACC;QACdH,SAAS,CAACI;YACN,IAAI,CAACD,SAAS;gBACV,kDAAkD;gBAClD,OAAO;oBACHT;oBACAI;iBACH;YACL;YACA,IAAIK,OAAO,CAAC,EAAE,IAAIP,SAAS;gBACvB,IAAIS,OAAOC,EAAE,CAACF,SAAS,CAAC,EAAE,EAAEN,WAAW;oBACnC,OAAOM,WAAW,WAAW;gBACjC;gBACA,OAAO;oBACHV;oBACAI;iBACH;YACL;YACA,IAAI;gBACA,IAAIO,OAAOC,EAAE,CAACF,SAAS,CAAC,EAAE,EAAED,OAAO,CAAC,EAAE,GAAG;oBACrC,OAAOC,WAAW,gBAAgB;gBACtC;gBACA,MAAMG,eAAejB,SAASa,OAAO,CAAC,EAAE;gBACxC,IAAIE,OAAOC,EAAE,CAACF,SAAS,CAAC,EAAE,EAAEG,eAAe;oBACvC,OAAOH,WAAW,gBAAgB;gBACtC;gBACA,OAAO;oBACHD,OAAO,CAAC,EAAE;oBACVI;iBACH;YACL,EAAE,OAAOC,GAAG;YACZ,6CAA6C;YAC7C;YACA,sCAAsC;YACtC,OAAO;gBACHJ,SAAS,CAAC,EAAE;gBACZA,SAAS,CAAC,EAAE;aACf,EAAE,kBAAkB;QACzB;IACJ;IACA,IAAI,CAACC,OAAOC,EAAE,CAACP,KAAK,CAAC,EAAE,EAAED,WAAW;QAChC,qBAAqB;QACrB,2CAA2C;QAC3CI,SAASO;IACb;IACA,MAAMC,iBAAiBC,IAAAA,gCAAgB,EAACT;IACxCU,IAAAA,yCAAyB,EAAC;QACtBf,UAAUgB,IAAI,CAACH;QACf,OAAO;YACH,MAAMI,QAAQjB,UAAUkB,OAAO,CAACL;YAChCb,UAAUmB,MAAM,CAACF,OAAO;QAC5B;IACJ,GAAG;QACCJ;QACAb;KACH;IACD,OAAOE,KAAK,CAAC,EAAE;AACnB"}